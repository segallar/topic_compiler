<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <!--link rel="icon" href="../../favicon.ico"-->

    <title>Topic compiler</title>
   
    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="lib/bootstrap/css/bootstrap.min.css" />

    <!-- Custom styles for this template -->
    <link href="tc.css" rel="stylesheet" />

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
      
  </head>

  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand menu-item" href="#" onclick="menuClick('');" id="menu-item-">Topic compiler</a>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav" id="menu">
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">

        <div class="main-text" id="main-text-">
            <h1>Topic compiler</h1>
            <p style="text-align:left">This is topic_compiler v0.1</p>
            
            <div class="col-md-6 col-md-offset-3" align="left" id="login_form">
              <div class="form-group">
                <label for="exampleInputEmail1">Email address</label>
                <input type="email" class="form-control" id="exampleInputEmail1" placeholder="Email">
              </div>
              <div class="form-group">
                <label for="exampleInputPassword1">Password</label>
                <input type="password" class="form-control" id="exampleInputPassword1" placeholder="Password">
              </div>
              <button type="submit" class="btn btn-default" onClick="submit_auth()">Submit</button>
            </div>
            
            <div class="row col-md-6 col-md-offset-3">
                <br/>
                <p style="text-align:left" id="test"> Testing connection to server ... </p>
            </div>
        </div>
  
      <div class="main-text" id="main-text-analytic">
           <h2>Analytic</h2>    
      </div>    
                
      <div class="main-text" id="main-text-texts">
          <h2>Texts</h2>
          <div>
          <ul class="nav nav-pills">
              <li role="presentation" id="text-pill-list" class="text-pill active"><a href="javascript:text_click('list')">List</a></li>
              <li role="presentation" id="text-pill-show" class="text-pill"><a href="javascript:text_click('show')">Show</a></li>
              <li role="presentation" id="text-pill-upload" class="text-pill"><a href="javascript:text_click('upload')">Upload</a></li>
          </ul>
          </div>
          <div id="text-page-list" class="text-page">
              List
          </div>
          <div id="text-page-show" class="hidden text-page">
              <a name="text-show-top"></a>
              <div id="text-show">Text to show</div>
          </div>
          <div id="text-page-upload" class="hidden text-page">
              <p align=left>Put your text here...</p>
              <textarea class="form-control" id="text-input"></textarea><br/>
              <p align=left><a class="btn btn-default" href="javascript:text_upload()">Upload</a></p>
              <div id="text-status" class="alert alert-success hidden" role="alert"></div>
          </div>
          
      </div>
      
      <div class="main-text" id="main-text-dic">
           <h2>Dictionary</h2>
            
      </div>    
        
      <div class="main-text" id="main-text-user">
          <br/><a class="btn btn-default" href="javascript:logout()" role="button">Logout</a>
          <table class="table table-striped table-condensed">
              <thead><tr><th>Parameter</th><th>Value</th></tr></thead>
              <tbody id="user-tbl"></tbody>
          </table>
      </div>
        
    <div class="point" id="point"></div>
    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="lib/jquery/jquery-2.1.1.min.js"></script>
    <script src="lib/bootstrap/js/bootstrap.min.js"></script>

<script>
    
//
// Texts
//

function texts_click(firstrun) {
    if(firstrun) {
        $(".text-page").hide();
        $("#text-page-list").show();
        $(".text-page").removeClass("hidden");
    }
}
    
function text_click( item ) {
    $(".text-page").hide();
    $(".text-pill").removeClass("active");
    $("#text-page-"+item).show();
    $("#text-pill-"+item).addClass("active");
}
    
function text_upload() {
    var text = $("#text-input").val();
    text = text.replace(/\r?\n/g, '<br />');
    $.ajax({
        url: '/server.php',
        type: 'POST',
        data: { text: text , cmd: 'txt_upload' },
        success: function(result) {
            $("#text-status").removeClass("hidden");
            $("#text-status").text('the request was successfully sent to the server');
            //$("#text-show").html( result ); 
        }
    });
}
    
//
// Auth
//
    
function connectionTest() {
    $("#main-text-").show();
    $("#test").html("<p class='label label-info'>Testing conn–µcetion to server ... </p>");
    $.getJSON("/server.php?cmd=hello") 
        .done(function( data ) {
            auth = false;
            if(data['auth']==true||data['auth']=="true") {
                if(!auth) {
                    auth = true;
                    show_all();
                }
            }
            $("#test").html("Connection to server - <b>"+data["hello"]+
                "</b><div> Auth - "+data['auth']+"</div>");
            if(auth) 
                $("#login_form").hide();
        })
        .fail(function( jqxhr, textStatus, error ) {
            $("#test").html("<div class='label label-danger'> Status - "+textStatus + ", error - " + error + "</div>"+
                "<br/><br/><div class='btn btn-primary' onClick=connectionTest()>Test again</div>");
        });
}

function submit_auth() {
    $.getJSON("/server.php?cmd=auth&auth_name="+$("#exampleInputEmail1").val()+"&auth_pass="+$("#exampleInputPassword1").val(), 
        function( data ) {
            $("#test").html("auth - "+data['auth']);
            if(data['auth']==true||data['auth']=="true") {
                show_all();
            }
    });
}    
    
function logout() {
    $.getJSON("/server.php?cmd=logout", 
        function( data ) {
            //$("#main-text-user").append("<div>"+data["auth"]+"</div>");
            auth = false;
            location.replace(location.origin+location.pathname);
        });
}  
  
//
// Menu
//
    
// Menu data    
var menu = {
    analytic : "Analytic",
    texts    : "Texts",
    dic      : "Dictionary",
    user     : "User"
};
  
isFunc = function(func){ return typeof window[func] === "function"; }    

function menuClick(item) {
    if(item!="") { 
        $("#menu-item-").css("color","darkgray");
    } else { 
        $("#menu-item-").css("color","white"); 
    }
    $(".menu-item").removeClass("active");
    $("#menu-item-" + item).addClass("active");
    $(".main-text").hide();
    $("#main-text-" + item ).show();
    if($("#menu-item-"+item).hasClass('first-run')) {
        first_run = true;
        $("#menu-item-"+item).removeClass('first-run');
    } else {
        first_run = false;
    } 
    if(isFunc(item+"_click")) 
        eval(item+"_click("+first_run+")");
}
    
function show_menu() {
    if( location.hash == "#" || location.hash == "" ) {
        $("#menu-item-").css("color","white"); 
        $("#main-text-").show();
        active = ""; 
    } else {
        $("#menu-item-").css("color","darkgray"); 
        active = location.hash.slice(1); 
    }
    $.each( menu , function (key, val) {
        if( active == key ) { 
            activeClass = " active"; 
        } else { 
            activeClass = ""; 
        }
        $("<li onClick='menuClick("+'"'+key+'"'+")' class=\"first-run menu-item "+activeClass+"\" id='menu-item-"+key+"'><a href='#"+key+"'>"+val+"</a></li>").appendTo("#menu");
    });
    if( location.hash != "" ) menuClick(active); 
}

function show_all() {
    $("#login_form").hide();
    show_menu();
}
    
//
// User
//    

function user_click() {
    $("#user-tbl").html("");
    $.getJSON("/server.php?cmd=hello&debug=on", 
        function( data ) {
            $.each( data , function (key, val) {
                $("<tr><td>"+key+"</td><td>"+val+"</td></tr>").appendTo("#user-tbl");
            });
        });
} 
   
// Init function
$( document ).ready( function() {
    // Loading ...
    $(".main-text").hide();
    
    // Testing connection to server
    connectionTest();
});
</script>
</body>
</html>

